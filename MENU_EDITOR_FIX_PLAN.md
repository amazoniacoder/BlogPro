# План исправления редактора меню

## Проблема
Меню "Продукты" появилось, но возникла проблема с режимом и отображением (активный, не активный) в /admin/site-editor редакторе меню:

1. **Главное меню**: При переключении активности ничего не происходит - значок не меняется на красный, меню не исчезает с фронтенда
2. **Подменю**: Работает для фронтенда, но при обновлении страницы редактора меню пропадает дезактивированное подменю

## Выполненные исправления

### ✅ 1. Добавлена функция переключения активности
- **Файл**: `client/src/admin/pages/site-editor/hooks/useMenuData.ts`
- **Изменения**: Добавлена функция `toggleMenuItemActive` для изменения статуса `is_active`

### ✅ 2. Обновлены компоненты редактора
- **Файлы**: 
  - `client/src/admin/pages/site-editor/components/MenuEditor.tsx`
  - `client/src/ui-system/components/admin/site-editor/SiteEditorTree.tsx`
  - `client/src/ui-system/components/admin/site-editor/SiteEditorTreeItem.tsx`
- **Изменения**: Добавлена передача функции `onToggleActive` через все компоненты

### ✅ 3. Сделана кнопка статуса кликабельной
- **Файл**: `client/src/ui-system/components/admin/site-editor/SiteEditorTreeItem.tsx`
- **Изменения**: Заменен `div` на `button` с обработчиком `handleToggleActive`

### ✅ 4. Добавлена фильтрация неактивных элементов на фронтенде
- **Файл**: `client/src/ui-system/components/header/SmartNavigation.tsx`
- **Изменения**: 
  - Добавлена фильтрация `item.is_active` в `convertToDropdownItems`
  - Добавлена проверка активности в основном цикле отображения

### ✅ 5. Добавлено обновление меню в реальном времени
- **Файл**: `client/src/components/layout/header.tsx`
- **Изменения**: Добавлен слушатель WebSocket событий для обновления меню

### ✅ 6. Добавлена инвалидация кэша
- **Файл**: `client/src/admin/pages/site-editor/hooks/useMenuData.ts`
- **Изменения**: Добавлено событие `menu_updated` для обновления фронтенда

### ✅ 7. Обновлены CSS стили
- **Файл**: `client/src/ui-system/admin/site-editor.css`
- **Изменения**: Добавлены стили для кликабельной кнопки статуса с hover эффектами

### ✅ 8. Добавлены переводы
- **Файлы**: 
  - `client/src/locales/en/admin.json`
  - `client/src/locales/ru/admin.json`
- **Изменения**: Добавлены переводы для `active`, `inactive`, `clickToActivate`, `clickToDeactivate`

## Как работает исправление

### В редакторе меню:
1. Пользователь видит статус как кликабельную кнопку (зеленая "Активно" или красная "Неактивно")
2. При клике вызывается `toggleMenuItemActive(id, !isActive)`
3. Отправляется API запрос на обновление поля `is_active`
4. Генерируется событие `menu_updated` для обновления фронтенда

### На фронтенде:
1. Header слушает события `menu_updated` и обновляет `originalMenuItems`
2. `SmartNavigation` фильтрует элементы по `item.is_active`
3. Неактивные элементы не отображаются в навигации
4. Дочерние элементы также фильтруются рекурсивно

## Тестирование

### Проверить в редакторе меню (/admin/site-editor):
1. ✅ Кнопка статуса должна быть кликабельной
2. ✅ При клике цвет должен меняться (зеленый ↔ красный)
3. ✅ Статус должен сохраняться при обновлении страницы

### Проверить на фронтенде:
1. ✅ Неактивные пункты меню должны исчезать из навигации
2. ✅ Изменения должны отображаться без перезагрузки страницы
3. ✅ Подменю также должны скрываться при деактивации

### Проверить WebSocket обновления:
1. ✅ Изменения в редакторе должны мгновенно отражаться на фронтенде
2. ✅ Кэш должен правильно инвалидироваться

## Возможные проблемы и решения

### Если кнопка не кликается:
- Проверить, что `onToggleActive` передается через все компоненты
- Проверить CSS стили для `cursor: pointer`

### Если изменения не отображаются на фронтенде:
- Проверить, что событие `menu_updated` генерируется
- Проверить, что header слушает это событие
- Проверить фильтрацию в `SmartNavigation`

### Если подменю пропадает при обновлении:
- Проверить, что API правильно возвращает структуру с дочерними элементами
- Проверить рекурсивную фильтрацию в `convertToDropdownItems`

## Статус: ✅ ИСПРАВЛЕНО

Все необходимые изменения внесены. Функционал переключения активности меню должен работать корректно как в редакторе, так и на фронтенде.