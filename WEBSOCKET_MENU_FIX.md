# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ WebSocket —Å–∏—Å—Ç–µ–º—ã –¥–ª—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –º–µ–Ω—é

## üîç –ê–Ω–∞–ª–∏–∑ WebSocket –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### –¢–µ–∫—É—â–∞—è —Å–∏—Å—Ç–µ–º–∞:
1. **–°–µ—Ä–≤–µ—Ä**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `req.app.locals.io.emit()` (Socket.IO)
2. **–ö–ª–∏–µ–Ω—Ç**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `websocketService` (–Ω–∞—Ç–∏–≤–Ω—ã–π WebSocket)
3. **–§—Ä–æ–Ω—Ç–µ–Ω–¥**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `window.dispatchEvent()` (custom events)

### –ü—Ä–æ–±–ª–µ–º—ã:
- **–ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤**: Socket.IO vs –Ω–∞—Ç–∏–≤–Ω—ã–π WebSocket
- **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π**: –†–∞–∑–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è
- **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏**: –°–æ–±—ã—Ç–∏—è –Ω–µ –¥–æ—Ö–æ–¥—è—Ç –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
**–§–∞–π–ª**: `server/api/menu/index.ts`

```typescript
// ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –î–≤–æ–π–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π
// Socket.IO –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
if (req.app.locals.io) {
  req.app.locals.io.emit('menuUpdated', menuItem);
}

// WebSocket –¥–ª—è –Ω–∞—Ç–∏–≤–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
const { broadcastToAll } = require('../../websocket');
broadcastToAll('menu_updated', { menuItem, type: 'update' });
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è**:
- –î–æ–±–∞–≤–ª–µ–Ω `broadcastToAll()` –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (create, update, delete)
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å Socket.IO
- –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã –∏–º–µ–Ω–∞ —Å–æ–±—ã—Ç–∏–π

### 2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –ø–æ–¥–ø–∏—Å–æ–∫
**–§–∞–π–ª**: `client/src/admin/pages/site-editor/hooks/useMenuData.ts`

```typescript
// ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Å–æ–±—ã—Ç–∏–π
websocketService.subscribe('menu_updated', fetchMenuItems);      // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1
websocketService.subscribe('menuUpdated', fetchMenuItems);       // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2
websocketService.subscribe('menuCreated', fetchMenuItems);       // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3
websocketService.subscribe('menuDeleted', fetchMenuItems);       // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 4
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è**:
- –£–ø–æ—Ä—è–¥–æ—á–µ–Ω—ã —Å–æ–±—ã—Ç–∏—è –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É
- –£–±—Ä–∞–Ω–æ –¥—É–±–ª–∏—Ä—É—é—â–µ–µ `window.dispatchEvent()`
- –°–µ—Ä–≤–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏—è

### 3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
**–§–∞–π–ª**: `client/src/components/layout/header.tsx`

```typescript
// ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ WebSocket
import('../../../services/websocket-service').then(({ default: websocketService }) => {
  websocketService.subscribe('menu_updated', handleMenuUpdate);
  websocketService.subscribe('menuUpdated', handleMenuUpdate);
  // ...
});
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è**:
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç `websocketService`
- –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
- Fallback –Ω–∞ custom events

## üéØ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ WebSocket –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –ü–æ—Ç–æ–∫ —Å–æ–±—ã—Ç–∏–π:
```
1. –ê–¥–º–∏–Ω –º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å –º–µ–Ω—é
2. API –æ–±–Ω–æ–≤–ª—è–µ—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
3. –°–µ—Ä–≤–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç:
   - Socket.IO: menuUpdated
   - WebSocket: menu_updated
4. –ö–ª–∏–µ–Ω—Ç—ã –ø–æ–ª—É—á–∞—é—Ç —Å–æ–±—ã—Ç–∏—è:
   - –ê–¥–º–∏–Ω–∫–∞: –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ä–µ–¥–∞–∫—Ç–æ—Ä
   - –§—Ä–æ–Ω—Ç–µ–Ω–¥: –æ–±–Ω–æ–≤–ª—è–µ—Ç –Ω–∞–≤–∏–≥–∞—Ü–∏—é
5. UI —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
```

### –ú–∞—Ä—à—Ä—É—Ç—ã —Å WebSocket:
**–§–∞–π–ª**: `client/src/services/websocket-service.ts`

```typescript
enabledRoutes = [
  '/admin/site-editor',  // ‚úÖ –†–µ–¥–∞–∫—Ç–æ—Ä –º–µ–Ω—é
  '/admin/blog',         // ‚úÖ –ê–¥–º–∏–Ω –±–ª–æ–≥
  '/admin/analytics',    // ‚úÖ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
  '/blog',               // ‚úÖ –§—Ä–æ–Ω—Ç–µ–Ω–¥ –±–ª–æ–≥
  '/',                   // ‚úÖ –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
  // ...
];
```

### –°–æ–±—ã—Ç–∏—è –¥–ª—è –º–µ–Ω—é:
- `menu_updated` - –æ—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
- `menuUpdated` - —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å Socket.IO
- `menuCreated` - —Å–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞
- `menuDeleted` - —É–¥–∞–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ WebSocket

### –í –∞–¥–º–∏–Ω–∫–µ (/admin/site-editor):
1. ‚úÖ –û—Ç–∫—Ä—ã—Ç—å DevTools ‚Üí Network ‚Üí WS
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ WebSocket
3. ‚úÖ –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –º–µ–Ω—é
4. ‚úÖ –£–≤–∏–¥–µ—Ç—å —Å–æ–±—ã—Ç–∏–µ `menu_updated` –≤ –∫–æ–Ω—Å–æ–ª–∏

### –ù–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ:
1. ‚úÖ –û—Ç–∫—Ä—ã—Ç—å –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
2. ‚úÖ –í –¥—Ä—É–≥–æ–π –≤–∫–ª–∞–¥–∫–µ –∏–∑–º–µ–Ω–∏—Ç—å –º–µ–Ω—é –≤ –∞–¥–º–∏–Ω–∫–µ
3. ‚úÖ –ú–µ–Ω—é –¥–æ–ª–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å—Å—è –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–±—ã—Ç–∏–π:
```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
websocketService.subscribe('menu_updated', (data) => {
  console.log('Menu updated:', data);
});
```

## üìã –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### –°–µ—Ä–≤–µ—Ä:
1. `server/api/menu/index.ts` - –¥–æ–±–∞–≤–ª–µ–Ω `broadcastToAll()`
2. `server/websocket.ts` - —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç `broadcastToAll()`

### –ö–ª–∏–µ–Ω—Ç:
1. `client/src/admin/pages/site-editor/hooks/useMenuData.ts` - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –ø–æ–¥–ø–∏—Å–∫–∏
2. `client/src/components/layout/header.tsx` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ WebSocket
3. `client/src/services/websocket-service.ts` - —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω—É–∂–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

### WebSocket —Å–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å:
- **–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞**: –û–¥–∏–Ω –ø—Ä–æ—Ç–æ–∫–æ–ª –¥–ª—è –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π
- **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–∞**: –°–æ–±—ã—Ç–∏—è –¥–æ—Ö–æ–¥—è—Ç –¥–æ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞**: –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏–π
- **–°–æ–≤–º–µ—Å—Ç–∏–º–∞**: –†–∞–±–æ—Ç–∞–µ—Ç —Å Socket.IO –∏ –Ω–∞—Ç–∏–≤–Ω—ã–º WebSocket

### –î–ª—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –º–µ–Ω—é:
- **–ê–¥–º–∏–Ω–∫–∞**: –ü–æ–ª—É—á–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ `websocketService`
- **–§—Ä–æ–Ω—Ç–µ–Ω–¥**: –ü–æ–ª—É—á–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ `websocketService`
- **Real-time**: –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤–∏–¥–Ω—ã –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
- **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: Fallback –Ω–∞ custom events

–¢–µ–ø–µ—Ä—å WebSocket —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –¥–ª—è –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã –º–µ–Ω—é!